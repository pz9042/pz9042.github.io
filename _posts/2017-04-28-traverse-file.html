---
layout: article
title:  "遍历目录下不一致的文件"
tags: php svn
categories: 代码块
date: 2017-04-28 22:07:00
---
<div id='preview-contents' class='note-content'>
                        
                    



<h3 id="遍历目录下不一致的文件">遍历目录下不一致的文件</h3>



<pre class="prettyprint hljs-dark"><code class="language-php hljs"><span class="hljs-meta">&lt;?php</span><br>$model = <span class="hljs-keyword">isset</span>( $_GET[<span class="hljs-string">'m'</span>] ) ? $_GET[<span class="hljs-string">'m'</span>] : <span class="hljs-string">'backend'</span>;<br>$separator = PHP_SAPI == <span class="hljs-string">'cli'</span> ? PHP_EOL :<span class="hljs-string">'&lt;br /&gt;'</span>;<br><br><br>set_time_limit(<span class="hljs-number">0</span>);<br>header( <span class="hljs-string">'content-type:text/html;charset=utf-8'</span> );<br>$filter = <span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">'yii'</span> =&gt;<span class="hljs-keyword">array</span>( <span class="hljs-string">'config'</span> ,<span class="hljs-string">'controllers'</span> ,<span class="hljs-string">'models'</span> ,<span class="hljs-string">'vendor'</span>,<span class="hljs-string">'views'</span> ,<span class="hljs-string">'web'</span> ),<br>    <span class="hljs-comment">//'yii' =&gt;array( 'web'),</span><br>    <span class="hljs-string">'tp'</span> =&gt;<span class="hljs-keyword">array</span>( <span class="hljs-string">'Application'</span> ),<br>);<br><br><br><br><br>$dev_dir = <span class="hljs-string">'E:\xampp\htdocs\zintao_subversion\\'</span>.$model.<span class="hljs-string">'\branches\dev'</span>;<br>$trunk_dir = <span class="hljs-string">'E:\xampp\htdocs\zintao_subversion\\'</span>.$model.<span class="hljs-string">'\trunk'</span>;<br><br><br><span class="hljs-keyword">if</span>( file_exists( $dev_dir.<span class="hljs-string">'/index.php'</span> ) ){<br>    $framework = <span class="hljs-string">'tp'</span>;<br>}<span class="hljs-keyword">else</span>{<br>    $framework = <span class="hljs-string">'yii'</span>;<br>}<br><br><br><br><br>$not_exists = <span class="hljs-keyword">array</span>();<br>$diff = <span class="hljs-keyword">array</span>();<br><span class="hljs-keyword">foreach</span>( $filter[$framework] <span class="hljs-keyword">as</span> $dir ){<br><br><br>    chdir( $dev_dir.<span class="hljs-string">'/'</span> .$dir );<br>    $dev_files = list_files( <span class="hljs-string">''</span> );<br><br><br>    $all_files = <span class="hljs-keyword">array</span>();<br>    <span class="hljs-keyword">foreach</span> ($dev_files <span class="hljs-keyword">as</span> $file ) {<br>        $target_file = $trunk_dir .<span class="hljs-string">'/'</span> .$dir .<span class="hljs-string">'/'</span> .$file;<br>        <span class="hljs-keyword">if</span>( is_dir( $file ) ) <span class="hljs-keyword">continue</span>;<br>        <span class="hljs-keyword">if</span>( !file_exists( $target_file ) ){<br>            $not_exists[] = $dir .<span class="hljs-string">'/'</span>.$file;<br>            <span class="hljs-keyword">continue</span>;<br>        }<br><br><br><br><br><br><br>        <span class="hljs-keyword">if</span>( md5_file( $file ) != md5_file( $target_file ) ){<br><br><br>            $diff[$dir .<span class="hljs-string">'/'</span>.$file] = <span class="hljs-keyword">array</span>( <span class="hljs-string">'s'</span> =&gt;filesize( $file ) ,<span class="hljs-string">'t'</span> =&gt;filesize( $target_file ) );<br>            <span class="hljs-keyword">continue</span>;<br>        }<br><br><br><br><br>    }<br>}<br><br><br><br><br><span class="hljs-keyword">if</span>( $not_exists ){<br>    $not_exists = array_values( $not_exists );<br><br><br>    <span class="hljs-comment">//print_r($not_exists);</span><br>    <span class="hljs-keyword">foreach</span> ($not_exists <span class="hljs-keyword">as</span> $key =&gt; $value) {<br><br><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">'在trunk中，文件 '</span> .addslashes( $value ). <span class="hljs-string">' 不存在'</span> .$separator;<br><br><br>    }<br>}<br><br><br><span class="hljs-keyword">echo</span> $separator,$separator;<br><br><br><span class="hljs-keyword">if</span>( $diff ){<br>    <span class="hljs-keyword">foreach</span> ($diff <span class="hljs-keyword">as</span> $key =&gt; $value) {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">'文件 '</span> .$key .<span class="hljs-string">' dev中和trunk中不一致,dev大小'</span> .addslashes( $value[<span class="hljs-string">'s'</span>] ).<span class="hljs-string">',trunk中大小为'</span> .addslashes( $value[<span class="hljs-string">'t'</span>] ) .$separator;<br>    }<br>}<br><br><br><br><br><br><br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">list_files</span><span class="hljs-params">( $dir ,$parten = <span class="hljs-string">'*'</span> )</span> </span>{<br><br><br>    <span class="hljs-comment">//static $all_files = array();</span><br>    <span class="hljs-keyword">global</span> $all_files;<br><br><br>    <span class="hljs-keyword">if</span>( $dir != <span class="hljs-string">''</span> ){<br><br><br>        $parten = <span class="hljs-string">'/'</span> .$parten;<br>        <span class="hljs-comment">//echo 33;exit;</span><br>        <span class="hljs-comment">//print_r(glob($dir. $parten ));exit;</span><br>        <span class="hljs-comment">//print_r( glob($dir. $parten ) );exit;</span><br><br><br>    }<br>    <span class="hljs-keyword">if</span>( $dir ==<span class="hljs-string">'Runtime'</span> ){<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">array</span>();<br>    }<br>    <span class="hljs-comment">//print_r(glob($dir. $parten ));exit;</span><br>    <span class="hljs-keyword">foreach</span>( glob($dir. $parten ) <span class="hljs-keyword">as</span> $file) {<br><br><br>        <span class="hljs-keyword">if</span>( is_dir( $file ) ){<br>            <span class="hljs-comment">//echo $file;exit;</span><br>            <span class="hljs-comment">//echo $file,"&lt;br /&gt;";</span><br><br><br>            <span class="hljs-comment">//array_push( $all_files ,$file );</span><br>            list_files( $file );<br>            <span class="hljs-comment">//$all_files = array_merge( $all_files , list_files( $file ));</span><br>            <span class="hljs-comment">//print_r( $all_files );exit;</span><br><br><br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-comment">//echo $file,"&lt;br /&gt;";</span><br>            $all_files[] = $file;<br>            <span class="hljs-comment">//array_push( $all_files ,$file );</span><br><br><br>        }<br>    }<br>    <span class="hljs-keyword">return</span> $all_files;<br></code></pre></div></body></html>